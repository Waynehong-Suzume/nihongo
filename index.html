<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GC-Lingo | ì¼ë³¸ì–´ ë‹¨ì–´ ì£¼ê´€ì‹ í€´ì¦ˆ</title>
  <meta name="description" content="ì¼ë³¸ì–´ ë‹¨ì–´/ëœ» ëœë¤ ì£¼ê´€ì‹ í€´ì¦ˆ Â· ëª¨ë°”ì¼/PC Â· ì˜¤í”„ë¼ì¸(PWA) Â· ë¡œì»¬ ì „ìš©" />
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#111827" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    input, button { font-size: 16px; }
    dialog { border: none; border-radius: 1rem; }
  </style>
</head>
<body class="min-h-screen bg-gray-950 text-gray-100">
  <div class="max-w-3xl mx-auto px-4 py-6">
    <header class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold">ê·¼ì°¬ë§¨ ì „ìš© ì¼ë³¸ì–´ í€´ì¦ˆì‡¼</h1>
      <div class="flex items-center gap-2">
        <button id="btnInstall" class="hidden px-3 py-1.5 rounded-xl bg-indigo-600 hover:bg-indigo-500">ì•± ì„¤ì¹˜</button>
        <button id="btnManage" class="px-3 py-1.5 rounded-xl bg-gray-800 hover:bg-gray-700">ë‹¨ì–´ ê´€ë¦¬</button>
      </div>
    </header>

    <!-- ì»¨íŠ¸ë¡¤ ë°” -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
      <div class="p-3 rounded-2xl bg-gray-900 border border-gray-800">
        <label class="block text-sm text-gray-400 mb-1">ì¶œì œ ë°©í–¥</label>
        <select id="selDirection" class="w-full bg-gray-800 rounded-xl px-3 py-2">
          <option value="random">ëœë¤ (ë‹¨ì–´â†”ëœ»)</option>
          <option value="jp2ko">ì¼ë³¸ì–´ â†’ í•œêµ­ì–´</option>
          <option value="ko2jp">í•œêµ­ì–´ â†’ ì¼ë³¸ì–´</option>
        </select>
      </div>
      <div class="p-3 rounded-2xl bg-gray-900 border border-gray-800">
        <label class="block text-sm text-gray-400 mb-1">ì„¸ì…˜ ê¸¸ì´</label>
        <select id="selSession" class="w-full bg-gray-800 rounded-xl px-3 py-2">
          <option value="10">10ë¬¸ì œ</option>
          <option value="20">20ë¬¸ì œ</option>
          <option value="30" selected>30ë¬¸ì œ</option>
          <option value="0">ë¬´ì œí•œ</option>
        </select>
      </div>
      <div class="p-3 rounded-2xl bg-gray-900 border border-gray-800 flex items-center justify-center">
        <button id="btnRestart" class="px-3 py-2 rounded-xl bg-gray-800 hover:bg-gray-700 w-full md:w-auto">ë‹¤ì‹œí•˜ê¸°</button>
      </div>
    </section>

    <!-- í€´ì¦ˆ ì˜ì—­ -->
    <main class="rounded-2xl bg-gray-900 border border-gray-800 p-4">
      <div class="flex items-center justify-start">
        <div class="text-sm text-gray-400">ë¬¸í•­ <span id="spnCount">0</span> / <span id="spnTarget">0</span></div>
      </div>

      <div class="mt-4 text-center">
        <div id="promptBadge" class="inline-block mb-3 text-xs px-2 py-1 rounded-full bg-indigo-900/40 border border-indigo-800 text-indigo-200">Ready</div>
        <p id="prompt" class="text-lg md:text-xl font-semibold tracking-tight leading-snug">ì‹œì‘ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
        <p id="subPrompt" class="mt-2 text-sm text-gray-400"></p>
      </div>

      <!-- ì…ë ¥ í¼: ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ -->
      <form id="answerForm" class="mt-6 flex flex-col md:flex-row gap-3 hidden" autocomplete="off">
        <input id="answerInput" class="flex-1 px-4 py-3 rounded-2xl bg-gray-800 border border-gray-700 focus:outline-none" placeholder="ì—¬ê¸°ì— ì •ë‹µì„ ì…ë ¥(Enter)" />
        <button id="btnSubmit" class="px-5 py-3 rounded-2xl bg-indigo-600 hover:bg-indigo-500" type="submit">ì œì¶œ (Enter)</button>
      </form>

      <div id="resultBox" class="hidden mt-5 p-4 rounded-2xl border"></div>

      <!-- ì‹œì‘ ë²„íŠ¼: ì¤‘ì•™ ì •ë ¬ -->
      <div id="startBar" class="mt-6 flex flex-col items-center gap-2">
        <button id="btnStart" class="px-6 py-3 rounded-xl bg-emerald-600 hover:bg-emerald-500">START!</button>
      </div>
    </main>

    <footer class="mt-8 text-center text-xs text-gray-500">ì˜¤í”„ë¼ì¸ ë™ì‘ Â· ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì € ë¡œì»¬ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</footer>
  </div>

  <!-- ë‹¨ì–´ ê´€ë¦¬ ëª¨ë‹¬ -->
  <dialog id="dlgManage" class="backdrop:bg-black/50 w-[min(100%,42rem)] p-0">
    <form method="dialog" class="p-0 m-0">
      <div class="p-4 bg-gray-900 border-b border-gray-800 flex items-center justify-between rounded-t-2xl">
        <h2 class="font-semibold">ë‹¨ì–´ ê´€ë¦¬</h2>
        <button id="btnCloseManage" class="px-3 py-1.5 rounded-xl bg-gray-800">ë‹«ê¸°</button>
      </div>
      <div class="p-4 bg-gray-900">
        <div class="flex flex-col md:flex-row gap-3 mb-3">
          <input id="inJP" class="flex-1 px-3 py-2 rounded-xl bg-gray-800 border border-gray-700" placeholder="ì¼ë³¸ì–´ (ì—¬ëŸ¬ ì •ë‹µì€ ; ë¡œ êµ¬ë¶„)" />
          <input id="inKO" class="flex-1 px-3 py-2 rounded-xl bg-gray-800 border border-gray-700" placeholder="í•œêµ­ì–´ ëœ» (ì—¬ëŸ¬ ì •ë‹µì€ ; ë¡œ êµ¬ë¶„)" />
          <button id="btnAdd" class="px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-500" type="button">ì¶”ê°€</button>
        </div>
        <div class="flex items-center gap-2 text-sm mb-3">
          <input id="ckShowData" type="checkbox" class="accent-indigo-600" />
          <label for="ckShowData">ì›ì‹œ ë°ì´í„° ë³´ê¸°(JSON)</label>
          <button id="btnExport" class="ml-auto px-3 py-1.5 rounded-xl bg-gray-800" type="button">Export</button>
          <label class="px-3 py-1.5 rounded-xl bg-gray-800 cursor-pointer">Import <input id="fileImport" type="file" accept=".json,.txt" class="hidden" /></label>
          <button id="btnSample" class="px-3 py-1.5 rounded-xl bg-gray-800" type="button">ìƒ˜í”Œ ë¡œë“œ</button>
          <button id="btnClear" class="px-3 py-1.5 rounded-xl bg-red-700/80 hover:bg-red-700" type="button">ì „ì²´ ì‚­ì œ</button>
        </div>
        <textarea id="taRaw" class="hidden w-full h-40 p-3 rounded-xl bg-gray-950 border border-gray-800 text-xs"></textarea>
        <div id="listWrap" class="max-h-72 overflow-y-auto rounded-xl border border-gray-800"></div>
      </div>
    </form>
  </dialog>

  <script>
  // ===== GC-Lingo core (ì¤‘ë³µ ì¶œì œ ë°©ì§€ / ë‹¨ì–´ ìˆ˜ ê¸°ë°˜ ì¹´ìš´íŠ¸ / ë‹¨ì–´ ê´€ë¦¬ ë™ì‘) =====
  (function(){
    // ----- Storage -----
    var LS_KEY='gc_lingo_deck_v1';
    function loadDeck(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)||'[]'); }catch(e){ return []; } }
    function saveDeck(d){ localStorage.setItem(LS_KEY, JSON.stringify(d)); }

    // ----- State -----
    var DECK=loadDeck();
    var USED=[]; // ì´ë²ˆ ì„¸ì…˜ì— ì´ë¯¸ ë‚¸ ì¸ë±ìŠ¤
    var SESSION={ target:0, count:0, correct:0, total:0 };
    var CUR=null; // {idx, item, mode}

    // ----- DOM -----
    var selDirection=document.getElementById('selDirection');
    var selSession=document.getElementById('selSession'); // (í˜„ì¬ëŠ” í‘œê¸°ìš©, ì‹¤ ì‚¬ìš©ì€ ë‹¨ì–´ì¥ ê¸¸ì´)
    var spnCount=document.getElementById('spnCount');
    var spnTarget=document.getElementById('spnTarget');
    var promptEl=document.getElementById('prompt');
    var subPrompt=document.getElementById('subPrompt');
    var promptBadge=document.getElementById('promptBadge');
    var answerForm=document.getElementById('answerForm');
    var answerInput=document.getElementById('answerInput');
    var resultBox=document.getElementById('resultBox');
    var btnStart=document.getElementById('btnStart');
    var startBar=document.getElementById('startBar');
    var btnRestart=document.getElementById('btnRestart');

    // Manage modal
    var btnManage=document.getElementById('btnManage');
    var dlgManage=document.getElementById('dlgManage');
    var btnCloseManage=document.getElementById('btnCloseManage');
    var inJP=document.getElementById('inJP');
    var inKO=document.getElementById('inKO');
    var btnAdd=document.getElementById('btnAdd');
    var listWrap=document.getElementById('listWrap');
    var taRaw=document.getElementById('taRaw');
    var ckShowData=document.getElementById('ckShowData');
    var fileImport=document.getElementById('fileImport');
    var btnExport=document.getElementById('btnExport');
    var btnSample=document.getElementById('btnSample');
    var btnClear=document.getElementById('btnClear');

    // ----- Utils -----
    function toHiragana(s){ return s.replace(/[ã‚¡-ãƒ³]/g,function(ch){ return String.fromCharCode(ch.charCodeAt(0)-96); }); }
    function normalize(s){ s=(s==null? '': String(s)).trim().toLowerCase(); try{s=s.normalize('NFKC');}catch(e){}; s=s.replace(/[\u2010-\u2015]/g,'-').replace(/[\u3000\s]+/g,' ').replace(/[\p{P}\p{S}]/gu,''); return s; }
    function normJP(s){ return normalize(toHiragana(s)); }
    function normKO(s){ return normalize(s); }
    function levenshtein(a,b){ var m=a.length,n=b.length; if(!m) return n; if(!n) return m; var dp=new Array(m+1); for(var i=0;i<=m;i++){ dp[i]=new Array(n+1); dp[i][0]=i; } for(var j=0;j<=n;j++) dp[0][j]=j; for(i=1;i<=m;i++){ for(j=1;j<=n;j++){ var cost=a.charAt(i-1)===b.charAt(j-1)?0:1; var v1=dp[i-1][j]+1, v2=dp[i][j-1]+1, v3=dp[i-1][j-1]+cost; dp[i][j]=Math.min(v1,v2,v3); } } return dp[m][n]; }
    function fuzzyEq(a,b){ var A=normalize(a), B=normalize(b); var dist=levenshtein(A,B); var tol=Math.max(1, Math.floor(Math.max(A.length,B.length)*0.15)); return dist<=tol; }

    // ìƒ˜í”Œ(ë²„íŠ¼ìœ¼ë¡œë§Œ ë¡œë“œ)
    var SAMPLE=[
      { jp:['ãŠç–²ã‚Œã•ã¾ã§ã™','ãŠã¤ã‹ã‚Œã•ã¾ã§ã™'], ko:['ìˆ˜ê³  ë§ìœ¼ì‹­ë‹ˆë‹¤','ìˆ˜ê³ í•´ìš”'] },
      { jp:['å·®ã—æ”¯ãˆãªã‘ã‚Œã°','ã•ã—ã¤ã‹ãˆãªã‘ã‚Œã°'], ko:['ê´œì°®ìœ¼ì‹œë‹¤ë©´','ì‹¤ë¡€ê°€ ì•ˆ ëœë‹¤ë©´'] },
      { jp:['ãŠå…ˆã«å¤±ç¤¼ã—ã¾ã™','ãŠã•ãã«ã—ã¤ã‚Œã„ã—ã¾ã™'], ko:['ë¨¼ì € ì‹¤ë¡€í•˜ê² ìŠµë‹ˆë‹¤'] },
      { jp:['å¤§ä¸ˆå¤«'], ko:['ê´œì°®ë‹¤','ë¬¸ì œì—†ë‹¤'] },
      { jp:['ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™'], ko:['ê°ì‚¬í•©ë‹ˆë‹¤','ê³ ë§™ìŠµë‹ˆë‹¤'] }
    ];

    // ----- Unique random picker -----
    function pickMode(){ var d=selDirection.value; return d==='random' ? (Math.random()<0.5?'jp2ko':'ko2jp') : d; }
    function nextUniqueIndex(){
      if(USED.length >= DECK.length){ return -1; }
      var idx; var safety=0;
      do{ idx=Math.floor(Math.random()*DECK.length); safety++; if(safety>10000) break; } while(USED.indexOf(idx)!==-1);
      return idx;
    }

    function startSession(){
      DECK=loadDeck();
      if(!Array.isArray(DECK) || DECK.length===0){ alert('ë‹¨ì–´ì¥ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.'); return; }
      USED=[];
      // ìš”ì²­: ë¬¸í•­ 0 / (ë“±ë¡ëœ ë‹¨ì–´ ìˆ˜)
      SESSION={ target: DECK.length, count:0, correct:0, total:0 };
      spnCount.textContent='0';
      spnTarget.textContent=String(DECK.length);
      answerForm.classList.remove('hidden');
      startBar.classList.add('hidden');
      resultBox.classList.add('hidden');
      nextQuestion();
      answerInput.focus();
    }

    function nextQuestion(){
      if(DECK.length===0){ alert('ë‹¨ì–´ì¥ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.'); return; }
      if(USED.length >= DECK.length){
        alert('ë” ì´ìƒ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');
        endSession();
        return;
      }
      var idx=nextUniqueIndex();
      if(idx===-1){ alert('ë” ì´ìƒ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.'); endSession(); return; }
      USED.push(idx);
      CUR={ idx: idx, item: DECK[idx], mode: pickMode() };
      SESSION.count = USED.length; // ì§„í–‰ ì¹´ìš´íŠ¸ = ì‚¬ìš©í•œ ì¹´ë“œ ìˆ˜
      spnCount.textContent=String(SESSION.count);

      promptBadge.textContent=(CUR.mode==='jp2ko'? 'ì¼ë³¸ì–´ â†’ í•œêµ­ì–´':'í•œêµ­ì–´ â†’ ì¼ë³¸ì–´');
      if(CUR.mode==='jp2ko'){
        promptEl.textContent = CUR.item.jp[0];
        subPrompt.textContent = (CUR.item.jp.slice(1).join(' / '));
      } else {
        promptEl.textContent = CUR.item.ko[0];
        subPrompt.textContent = (CUR.item.ko.slice(1).join(' / '));
      }
      answerInput.value='';
    }

    function judge(user){
      var item=CUR.item, mode=CUR.mode;
      var okList=(mode==='jp2ko'? item.ko: item.jp);
      var userNorm=(mode==='jp2ko'? normKO(user): normJP(user));
      var match=false;
      for(var i=0;i<okList.length;i++){
        var cand=(mode==='jp2ko'? normKO(okList[i]): normJP(okList[i]));
        if(fuzzyEq(userNorm,cand)){ match=true; break; }
      }
      return {match:match, okList:okList};
    }

    function showResult(match, okList){
      resultBox.classList.remove('hidden');
      resultBox.className='mt-5 p-4 rounded-2xl border '+(match? 'bg-emerald-900/20 border-emerald-800':'bg-red-900/20 border-red-800');
      var codes=''; for(var i=0;i<okList.length;i++){ codes += '<code class="px-1 py-0.5 bg-gray-800 rounded">'+ okList[i] +'</code> '; }
      resultBox.innerHTML =
        '<div class="flex items-center justify-between">'+
          '<div class="font-semibold">'+(match? 'ì •ë‹µ! âœ…':'ì˜¤ë‹µ âŒ')+'</div>'+
          '<div class="text-xs text-gray-400">Ctrl+N ë‹¤ìŒ</div>'+
        '</div>'+
        '<div class="mt-2 text-sm">'+
          '<div class="text-gray-400">ëª¨ë²” ë‹µì•ˆ</div>'+
          '<div class="mt-1">'+ codes +'</div>'+
        '</div>'+
        '<button id="btnNext" class="mt-3 px-3 py-1.5 rounded-xl bg-indigo-600 hover:bg-indigo-500">ë‹¤ìŒ ë¬¸ì œ</button>';
      var btnNext=document.getElementById('btnNext');
      btnNext.onclick=function(){ handleNext(match); };
    }

    function finalizeAnswer(correct){ SESSION.total++; if(correct) SESSION.correct++; }
    function handleNext(wasCorrect){
      finalizeAnswer(wasCorrect);
      if(USED.length >= DECK.length){ alert('ë” ì´ìƒ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.'); endSession(); return; }
      resultBox.classList.add('hidden');
      nextQuestion();
      answerInput.focus();
    }

    function endSession(){
      promptEl.textContent='ì„¸ì…˜ ì™„ë£Œ ğŸ‰ ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ [ì„¸ì…˜ ì‹œì‘]';
      subPrompt.textContent=''; promptBadge.textContent='Done';
      resultBox.classList.add('hidden'); answerForm.classList.add('hidden'); startBar.classList.remove('hidden');
    }

    // ì œì¶œ: ìƒˆë¡œê³ ì¹¨ ë°©ì§€
    answerForm.addEventListener('submit', function(e){
      e.preventDefault();
      var v=answerInput.value;
      var r=judge(v);
      showResult(r.match, r.okList);
    });

    // ì‹œì‘/ë‹¤ì‹œí•˜ê¸°
    btnStart.addEventListener('click', startSession);
    btnRestart.addEventListener('click', function(){
      endSession();
      spnCount.textContent='0'; spnTarget.textContent='0';
      promptBadge.textContent='Ready'; promptEl.textContent='ì‹œì‘ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”'; subPrompt.textContent='';
    });

    // ë‹¨ì¶•í‚¤: Ctrl+N ë‹¤ìŒ
    document.addEventListener('keydown', function(e){
      if(e.ctrlKey && String(e.key).toLowerCase()==='n'){
        e.preventDefault(); handleNext(false);
      }
    });

    // ----- ë‹¨ì–´ ê´€ë¦¬ -----
    function renderList(){
      listWrap.innerHTML='';
      if(ckShowData.checked){ taRaw.classList.remove('hidden'); taRaw.value=JSON.stringify(DECK,null,2); } else { taRaw.classList.add('hidden'); }
      if(!DECK.length){ listWrap.innerHTML='<div class="p-3 text-sm text-gray-400">(ë¹„ì–´ìˆìŒ)</div>'; return; }
      for(var i=0;i<DECK.length;i++){
        var it=DECK[i]; var row=document.createElement('div'); row.className='flex items-center gap-2 px-3 py-2 border-b border-gray-800';
        row.innerHTML='<div class="flex-1">'+
          '<div class="text-sm font-medium">'+ (it.jp||[]).join(' / ') +'</div>'+
          '<div class="text-xs text-gray-400">'+ (it.ko||[]).join(' / ') +'</div>'+
        '</div>'+
        '<button data-i="'+i+'" class="btnDel px-2 py-1 rounded bg-gray-800">ì‚­ì œ</button>';
        listWrap.appendChild(row);
      }
      var dels=listWrap.querySelectorAll('.btnDel');
      for(var j=0;j<dels.length;j++){
        dels[j].onclick=function(ev){ var idx=parseInt(ev.currentTarget.getAttribute('data-i'),10); DECK.splice(idx,1); saveDeck(DECK); renderList(); };
      }
    }
    function openManage(){
      if(dlgManage && typeof dlgManage.showModal==='function') dlgManage.showModal();
      else { dlgManage.setAttribute('open',''); document.body.classList.add('overflow-hidden'); }
      renderList();
    }
    function closeManage(){
      if(dlgManage && typeof dlgManage.close==='function') dlgManage.close();
      else { dlgManage.removeAttribute('open'); document.body.classList.remove('overflow-hidden'); }
    }
    if(btnManage) btnManage.addEventListener('click', openManage);
    if(btnCloseManage) btnCloseManage.addEventListener('click', function(e){ e.preventDefault(); closeManage(); });
    if(ckShowData) ckShowData.addEventListener('change', renderList);
    if(btnAdd) btnAdd.addEventListener('click', function(){
      var jp=inJP.value.trim(); var ko=inKO.value.trim(); if(!jp||!ko) return;
      var obj={ jp: jp.split(';').map(function(s){return s.trim();}).filter(Boolean),
                ko: ko.split(';').map(function(s){return s.trim();}).filter(Boolean) };
      DECK.push(obj); saveDeck(DECK); inJP.value=''; inKO.value=''; renderList();
    });
    if(btnExport) btnExport.addEventListener('click', function(){
      var blob=new Blob([JSON.stringify(DECK,null,2)], {type:'application/json'});
      var a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='gc-lingo-deck.json'; a.click();
    });
    if(fileImport) fileImport.addEventListener('change', function(e){
      var f=e.target.files[0]; if(!f) return; var reader=new FileReader();
      reader.onload=function(){
        try{
          var data=JSON.parse(reader.result);
          if(Array.isArray(data)){ DECK=data; saveDeck(DECK); USED=[]; renderList(); }
          else alert('JSON ë°°ì—´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
        }catch(err){ alert('JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); }
        finally{ fileImport.value=''; }
      };
      reader.readAsText(f);
    });
    if(btnSample) btnSample.addEventListener('click', function(){ DECK=SAMPLE.slice(); saveDeck(DECK); USED=[]; renderList(); });
    if(btnClear) btnClear.addEventListener('click', function(){ if(confirm('ì •ë§ ì „ì²´ ì‚­ì œí•©ë‹ˆê¹Œ?')){ DECK=[]; saveDeck(DECK); USED=[]; renderList(); } });

    // ----- PWA (ì„ íƒ) -----
    var deferredPrompt=null; var btnInstall=document.getElementById('btnInstall');
    window.addEventListener('beforeinstallprompt', function(e){ e.preventDefault(); deferredPrompt=e; btnInstall.classList.remove('hidden'); });
    if(btnInstall) btnInstall.addEventListener('click', function(){ if(!deferredPrompt) return; deferredPrompt.prompt(); deferredPrompt=null; btnInstall.classList.add('hidden'); });
    if('serviceWorker' in navigator){
      window.addEventListener('load', function(){ navigator.serviceWorker.register('./sw.js').catch(function(){}); });
    }
  })();
  </script>
</body>
</html>




